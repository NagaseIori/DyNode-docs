# 谱面编辑

本页面讲解 DyNode 谱面编辑的基本要素。

## 编辑模式

DyNode 共有五种编辑模式，以数字键 <kbd>1</kbd> ~ <kbd>5</kbd> 来进行切换。

* 放置模式：数字键 <kbd>1</kbd> ~ <kbd>3</kbd> 来放置音符。详见 [放置音符](#放置音符) 。
* 编辑模式：数字键 <kbd>4</kbd> 来编辑音符。例如选中音符、编辑音符、删除音符等。详见 [音符](#音符)。
* 预览模式：数字键 <kbd>5</kbd> 来对谱面进行预览。所有的特效在此模式都将默认开启，所有的编辑功能都将在此模式下关闭。

## 音符

音符共有三种类型。

- Note (Tap): 单点音符，最基本的音符
- Chain (Slide): 滑键，只要手指有放置就能判定的音符
- Hold: 长按直至尾部判定完全再松开的音符

除此以外，在 xml 格式数据的储存中也有额外的类型：

- Sub: Hold 的尾部音符，仅所在时间具有有意义的数据

### 放置音符

1. 数字键 <kbd>1</kbd> ~ <kbd>3</kbd> 切换至你想放置的音符。
2. 找到你想放置的位置，长按 Note 拖拽调整长度，松开放置。
3. 如果你放置的是 Hold，下一步继续选择 Hold 的尾端并点按放置。

最后一次手动放置单个音符的宽度将作为下一次放置音符的 _默认宽度_ 。

:::center
![Drop a note](https://user-images.githubusercontent.com/31349569/184546816-cc813b1b-844b-4eef-a959-e69022702f50.gif =400x)

![Drop_a_hold](https://user-images.githubusercontent.com/31349569/184546887-17f5d3d3-b9dc-4a36-a0b1-ab13a10130e2.gif =400x)
:::

### 移动音符

拖拽。

若想整体拖拽 Hold ，则在单个 Hold 被选中的情况下按住 <kbd>Ctrl</kbd> 拖动头部即可。在多选的情况下 Hold 将默认被整体拖拽。

:::center
![Drag a note](https://user-images.githubusercontent.com/31349569/184546984-f9bae40d-f543-4544-ab07-1902c2a80dd3.gif =400x)
:::

### 选中音符

拖拽并框选。

你可以按住 <kbd>Ctrl</kbd> 键来多选音符或反选音符。

:::center
![Multiselect](https://user-images.githubusercontent.com/31349569/184547121-032231e9-4c4a-4a7b-9cc1-b6c5c3e4e122.gif =400x)
:::

#### 批量移动音符

在选中音符后，拖拽即可。

#### 批量删除音符

在选中音符后，按下 <kbd>Backspace</kbd> 或 <kbd>Delete</kbd> 即可。

#### 批量调节音符宽度

在选中音符后，按下 <kbd>Ctrl</kbd> 并使用鼠标滚轮来快速调节音符宽度，或使用 <kbd>Ctrl</kbd> + <kbd>V</kbd> 来快速粘贴 _默认宽度_ 。

#### 复制音符宽度

在选中 **单个** 音符后，使用 <kbd>Ctrl</kbd> + <kbd>C</kbd> 来将此音符的宽度作为 _默认宽度_ 。

#### 复制音符

在选中音符后，按下 <kbd>Ctrl</kbd> + <kbd>C</kbd> ，右下角即会提示复制音符数量。

:::center
![Copy](https://user-images.githubusercontent.com/31349569/184547227-bbb12d78-0f0e-40b9-b0c2-77e69e3b8887.gif =400x)
:::

#### 粘贴音符

在复制音符后，按下 <kbd>Ctrl</kbd> + <kbd>V</kbd> ，在适当的位置像放置普通音符那样放置复制音符即可。

粘贴音符的时候，默认使用时间最早的音符当做选择的中心。如果你想更换这个中心（比如，你想以末尾的音符作为中心），用 <kbd>Ctrl</kbd> + <kbd>Left</kbd>/<kbd>Right</kbd> 来切换。

可以用 <kbd>Esc</kbd> 来退出粘贴，也可以直接使用数字键切换模式。

可以用 <kbd>Up</kbd> 或 <kbd>鼠标右键</kbd> 来切换你想要粘贴到的下落面。

可以用 <kbd>Ctrl</kbd> + <kbd>1</kbd>/<kbd>2</kbd> 来批量转换你想粘贴的音符。

:::center
![Paste](https://user-images.githubusercontent.com/31349569/184547335-9d6a2e4e-d2f1-4908-92d8-038683a371f4.gif =400x)
:::

### 对称 / 镜像音符

选中音符后，使用 <kbd>M</kbd> 来以该编辑侧的中心为准镜像音符。使用 <kbd>Ctrl+M</kbd> 来镜像复制音符。

选中**侧面**音符后，使用 <kbd>R</kbd> 来将音符对称移动到另一侧面。使用 <kbd>Ctrl+R</kbd> 来对称复制音符。

### 撤销与还原

使用 <kbd>Ctrl</kbd> + <kbd>Z</kbd>/<kbd>Y</kbd> 来撤销与还原。


## 默认宽度

默认宽度是你在放置 **单个音符** 时的设置宽度。

### 设置默认宽度
你可以在放置 **单个音符** 时，横向（或纵向）拖动鼠标来简单的更改默认宽度。

你也可以使用 <kbd>K</kbd> 来直接输入你想要的默认宽度值。它会修改**当前编辑侧**的默认宽度值。

你也可以选中 **单个音符** 后，使用 <kbd>Ctrl+C</kbd> 来将此音符的宽度作为默认宽度。


### 设置默认宽度模式

DyNode 提供四种设置默认宽度的模式，因为在 Dynamix 中，正侧面设置的同一宽度下，侧面的音符宽度以像素计为正面的一半。例如，正面与侧面的音符在宽度皆为 `1.0` 的情况下，正面的音符宽度为 `300` 像素，而侧面的音符宽度只为 `150` 像素。这同样也体现在游戏的判定上。

使用 <kbd>L</kbd> 来更改设置默认宽度的模式。一共有四种设置默认宽度的模式，这四种模式的默认宽度设置是全部分离的（通俗来讲，你在一个模式下改变了默认宽度，它不会影响到任何其它模式下的默认宽度设置），因此你可以根据情况来灵活切换默认宽度模式。

#### 宽度一致
这是 DyNode 默认的设置默认宽度模式。在该模式下，正侧面的默认宽度实时绑定并完全相等。

:::tip
这同样也是 Dynamaker 默认使用的处理正侧面默认宽度的方式。如果你感觉此功能过于复杂且可能对你没有帮助，则你无需更改设置默认宽度模式。
:::

#### 视觉一致
在该模式下，正侧面的默认宽度实时绑定，且侧面的默认宽度一定为正面的两倍。

例如，如果你在正面修改默认宽度为 1.0，则侧面的默认宽度也会同步修改为 2.0。相反同理。

这个模式可以保证你在三面上放置的音符在视觉上是完全等宽的。

#### 正侧面分离
在该模式下，正侧面的默认宽度是分离的，而左右侧面的默认宽度是实时绑定的。

通俗来讲，你在正面设置默认宽度时，侧面的默认宽度不会更改。相反同理。

#### 三面分离
在该模式下，所有编辑侧的默认宽度是全部分离的。

通俗来讲，你在任何一个编辑侧设置默认宽度时都不会影响到其它编辑侧的默认宽度。

## 编辑侧

### 切换编辑侧

用 <kbd>Up</kbd> 或 <kbd>鼠标右键</kbd> 拖拽来切换编辑侧。

亮起的判定线代表你正在编辑的侧面。

:::center
![Switch side](https://user-images.githubusercontent.com/31349569/184547647-4e148234-543a-413e-bdcb-b0498ca618be.gif =400x)
:::

### 透明化非编辑侧音符

按下 <kbd>F</kbd> 即可隐去非编辑侧音符。

:::center
![Fade side](https://user-images.githubusercontent.com/31349569/184547770-ef9add4d-0300-4a1e-89d1-dcd6af67d599.gif =400x)
:::

### 切换侧面下落类型

将编辑侧切换到左侧或右侧后，按下 <kbd>Ctrl</kbd> + <kbd>F</kbd> 来切换此侧面的下落类型。

- MULTI: 可以放置 Note, Hold 与 Chain 三种类型的音符
- PAD: 可以放置 Note 与 Hold 两种类型的音符。
- MIXER: 可以放置 Chain 类型的音符，带有滑板

目前的版本实际上对三种模式的音符放置都不带有严格限制。

## 网格吸附与拍线

开启纵向网格吸附与拍线的前提是正确配置 Timing Point ，详看 [校时](/guide/timing) 页面。

### 节拍线

:::tip 提示
若不存在 Timing Point 或拍线在第一个 Timing Point 之前，则拍线不会被显示。
:::
使用 <kbd>↓</kbd> / <kbd>←</kbd> / <kbd>→</kbd> 来调整对应编辑侧的节拍线透明度。共三档：0% / 50% / 100% 。

### 节拍线样式

使用 <kbd>J</kbd> 来修改节拍线的样式。共四种样式：默认 / 等长 / 单色 / 经典。

在等长模式下，所有的节拍线的长度都是相同的。在单色模式下，节拍线不具有颜色。

经典模式同时启用了等长模式与单色模式。

### 节拍细分（组）

使用 <kbd>C</kbd> / <kbd>V</kbd> 来切换节拍细分的细密程度。

使用 <kbd>G</kbd> 来切换节拍分组。

目前支持的节拍细分有：

- A 组：1/2，1/3 为基础的细分组，包括 1/4, 1/8, 1/6, 1/12 等。
- B 组：比较少见的 1/5，1/7 为基础的细分组，包括 1/10, 1/14, 1/20 等。

### 网格吸附的开关

:::warning 关于防糊机制
由于 Dynamix 的防糊机制，我们不建议在关闭纵向网格吸附的情况下手动放置双押，因为放置的音符的时间可能会出现小数点级的误差导致防糊机制被意外地触发。

如果你需要这么做，你可以先确保音符对齐再进行放置，或者选择在导出时选择整数时间转换。详见 [谱面导出](/guide/export) 。
:::

使用 <kbd>Z</kbd> 来开关纵向（时间）网格吸附。

使用 <kbd>X</kbd> 来开关横向（位置）网格吸附。

## 编辑界面

### 回放预览

使用 <kbd>Enter</kbd> 来从头开始预览你的谱面。

这会将你的编辑模式设置为预览模式。详见 [编辑模式](#编辑模式) 。

### 设置背景图片

使用 <kbd>F4</kbd> 来设置背景图片。

背景图片可以是常用图片格式，如 JPG/JPEG/PNG 文件。

### 设置背景视频

使用 <kbd>F4</kbd> 来导入背景视频。导入的背景视频将不会播放声音，且只在 [预览模式](#编辑模式) 下进行播放。

DyNode 对导入的背景视频格式有一定要求，我们建议在使用视频文件时对视频文件作一定的转码与压缩处理。你可以在 [这篇指南](https://osu.ppy.sh/wiki/zh/Guides/Compressing_files#video) 中看到详细的处理视频的方法。

如果你使用 [FFmpeg](https://ffmpeg.org/) 对视频进行处理，则可以参考以下命令行：
```bash
ffmpeg -i input -c:v libx264 -crf 20 -preset fast -an -sn -map_metadata -1 -map_chapters -1 -vf scale=-1:720 output.mp4
```

如果你已经安装好了 FFmpeg 并将其安装路径设置到 PATH 中，则可以将该命令存储到 `.bat` 后缀名的文本文件中并保存执行。

你应当将上方命令中的 `input` 替换成你想要转码的视频文件名（如 `video.mp4` ），命令将会在同一文件夹下导出转换后的视频文件 `output.mp4`。

:::warning
在设置背景视频之前，请确认你已经将视频文件按照上方指南转码成受支持的格式。

如果你使用背景视频出现了包括但不限于以下问题，请尝试保存项目并**重启应用**，若问题依旧，你可以选择**重设背景**来删除已经设置的图片与视频，或尝试更换背景视频文件：

* 特定视频导入超时（你的视频文件格式可能不受支持）
* 所有视频导入超时
* 视频卡顿、音画严重不同步

:::

### 重设背景

使用 <kbd>Ctrl+F4</kbd> 来重设所有背景，包括图片与视频。

重设背景将不会影响硬盘上的文件。

## Bar

:::info 提示
如果你不了解什么是 [Bar](/guide/timing.html#bar) 且你不打算使用 Dynamaker ，则你很可能无需使用到与 Bar 相关的任何功能。
:::

### 设置/删除全局 Bar 信息

若你的谱面并非从 Dynamaker 导入，你可以使用 <kbd>F6</kbd> 来设置/删除全局 Bar 信息。这些信息包括 Bar Per Minute 与 Bar Offset 。

:::tip
大多数情况下，你无需手动配置该信息。
:::

### 切换 Bar / Time 显示

使用 <kbd>Ctrl+B</kbd> 将音符显示的信息从毫秒切换至与 Dynamaker 相同的 Bar 显示。

## 延迟调整

你可以在 DyNode 中分别调整音乐播放与谱面音符的延迟。

### 谱面音符延迟调整

使用 <kbd>-/=</kbd> 来快速调整当前编辑谱面音符的延迟。

使用 <kbd>U</kbd> 来手动输入延迟进行精准的调整。

:::info 提示
该延迟调整的对象为谱面中**已经存在**的所有音符与Timing Points。
:::

### 全局音乐延迟调整

使用 <kbd>Ctrl + -/=</kbd> 来快速调整全局音乐播放的延迟。

:::info 提示
该延迟将与 MP3 固有的延迟 `FMOD_MP3_DELAY` 进行叠加，并且会作为配置保存在 DyNode 中。

你可以在 [Timing](timing#mp3-与-wav-格式的延迟) 与 [配置](configuration) 中看到更详细的说明。
:::

## 其它

### 全屏模式

使用 <kbd>F7</kbd> 来切换无边框全屏。
